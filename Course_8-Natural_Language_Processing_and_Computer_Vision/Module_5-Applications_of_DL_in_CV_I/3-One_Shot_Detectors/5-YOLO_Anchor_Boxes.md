# YOLO - Anchor Boxes

So far you have been dealing with cases where there was not more than one object present in a grid cell and you have tackled the challenge of multiple bounding boxes covering a single object (using IoU threshold and NMS). But there is another problem: What if there are more than one objects in a grid cell or overlapping objects in the image? How will the YOLO model detect objects in such a situation?

Let us watch the next video and try to understand how to solve this problem.

**VIDEO**

So, as you learnt in the video, there might be a possibility of overlapping objects being present in the same grid cell. In such cases, the concept of **anchor boxes** comes into play. In order to understand this concept, we will take a look at the example shown in this image.

![YOLO Anchor Boxes](https://i.ibb.co/J2X6NDC/YOKO-Anchor-Boxes-1.png)

So, as you can see in this image, the grid cell marked contains two objects: The person and the bike. In this case, the centroids of both these objects lie in this bounding box. Through using the techniques that we have discussed so far, the YOLO model would once register the object, which can either be the bike or the person and then this cell will be blocked for further inspection. This means that the second object will not be detected properly.

Anchor boxes would allow you to register both the objects, even though they are in the same grid cell. The bounding boxes of the two objects would look like this.

![YOLO Anchor Boxes](https://i.ibb.co/QpFs3QX/YOKO-Anchor-Boxes-2.png)

  
Now, let us try to understand the working of the anchor boxes step by step:

1.  Anchor boxes are nothing but a set of bounding boxes for each object in an image. These boxes have a predefined width and height.  
     
2.  The anchor boxes reflect these factors for the objects being detected:
    1.  Aspect ratio
    2.  Scale  
         
3.  They are selected based on the size of the training data by clustering the dimensions of the ground truth boxes provided with the data  
     
4.  The number of anchor boxes depends upon the number of objects being detected.  
     
5.  The final boxes are refined and corrected based on:
    1.  Background,
    2.  IoU and
    3.  The offsets for each anchor box.  
         
6.  YOLO predicts the probabilities and changes them in correspondence to each anchor box; then it uses them to refine the anchor box predictions.

Let us visualise the default bounding boxes next to the final bounding boxes and take a look at the offsets as shown in the image below:

![YOLO Anchor Boxes](https://i.ibb.co/kMXMPNF/YOKO-Anchor-Boxes-3.png)

If you recall the sliding window technique, which processed each part of an image separately for making predictions, and then compare it to the anchor box method, which can predict all the objects present in an image at once, you will be able to understand how this technique requires much less time and effort.

Through using techniques such as anchor boxes, YOLO is able to process an image and make predictions in one go; hence, it is known as a one-shot detector.  
   
Now, answer these questions based on your learning so far.

#### Anchor Boxes

Qn: Given below are the steps in the working of anchor boxes:

1.  Compute the IoU for each anchor box
2.  If IoU is greater than 50%, predict the object and learn from the prediction
3.  Calculate the loss in localisation
4.  If IoU is less than 50%, the object is not predicted, and there is no learning from this prediction
5.  Set initial values of the boxes for each predictor

Select the option that shows the correct order of these steps. (More than one option may be correct) Note: The IoU threshold is assumed to be 50% in this question.

- 1, 2, 3, 4, 5

- 5, 1, 3, 2, 4

- 5, 1, 3, 4, 2

- 5, 2, 3, 1, 4

Ans: B & C. *The anchor boxes first make initial predictions and compute the loss. In order to refine these predictions, they compute the IoU and make predictions and learn whether the IoU is greater than about 50%–60%. If the IoU is less than the threshold, learning does not occur. This depends upon the IoU for each prediction; hence, the positions of steps 2 and 4 can be interchanged based on the IoU.*

Qn: Recall that for detecting multiple objects, the YOLOv3 algorithm uses anchor boxes. Initially, there are many such anchor boxes generated by this algorithm. Out of all these initially generated boxes, only one is finally selected based on the selection criteria. 

For doing so, you will compute the IoU of all the anchor boxes around a certain object. Given that the threshold value of IoU is 60%. Which of the following is correct?

- If the highest IoU amongst all the anchor boxIoU’s is 40%, the model will predict the object and learn from this prediction.

- If the highest IoU amongst all the anchor box IoU’s is 70%, the model will predict the object and learn from this prediction.

- If the highest IoU amongst all the anchor box IoU’s is 70%, the model will not predict the object.

- If the highest IoU amongst all the anchor box IoU’s is 40%, the model will not predict the object.

Ans: B & D. *If the highest IoU is greater than the threshold value, only then the model will predict the object and also learn from it. If the highest IoU is less than the threshold value, the model does not predict the object.*

So far, we have covered the theory underlying YOLO. You will be able to understand this algorithm better once you have learnt how to create an object detector using a YOLOv3 pretrained model. We will discuss this in the next segment.

  
**Additional Reading**

1.  Explore more about anchor boxes [here](https://www.mathworks.com/help/vision/ug/anchor-boxes-for-object-detection.html).
2.  Read about the process of selection of anchor boxes in object detection using this [link](https://www.wovenware.com/blog/2020/06/anchor-boxes-in-object-detection-when-where-and-how-to-propose-them-for-deep-learning-apps/#.YQ4nFIgzbIU).